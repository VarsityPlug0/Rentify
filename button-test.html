<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .btn { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; border: none; }
        .btn-success { background: #28a745; color: white; border: none; }
        .btn-danger { background: #dc3545; color: white; border: none; }
        .status { padding: 10px; margin: 10px 0; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Button Functionality Test</h1>
    
    <div class="test-section">
        <h2>Authentication Status</h2>
        <div id="auth-status" class="status">Checking...</div>
        <button class="btn btn-primary" onclick="checkAuth()">Check Auth Status</button>
        <button class="btn btn-success" onclick="loginAsAdmin()">Login as Admin</button>
    </div>
    
    <div class="test-section">
        <h2>API Tests</h2>
        <div id="api-status" class="status">Ready to test</div>
        <button class="btn btn-primary" onclick="testPropertiesAPI()">Test Properties API</button>
        <button class="btn btn-primary" onclick="testApplicationsAPI()">Test Applications API</button>
    </div>
    
    <div class="test-section">
        <h2>Button Tests</h2>
        <div id="button-status" class="status">Ready to test</div>
        <button class="btn btn-success" onclick="testOpenModal()">Test Open Modal</button>
        <button class="btn btn-success" onclick="testLoadProperties()">Test Load Properties</button>
        <button class="btn btn-danger" onclick="testDeleteProperty(1)">Test Delete Property</button>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output" style="background: #f8f9fa; padding: 15px; height: 200px; overflow-y: scroll; font-family: monospace;">
            Console output will appear here...
        </div>
    </div>

    <script>
        // Override console.log to display in the page
        const originalLog = console.log;
        const consoleOutput = document.getElementById('console-output');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            consoleOutput.innerHTML += message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        // Test functions
        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/status');
                const data = await response.json();
                const statusDiv = document.getElementById('auth-status');
                
                if (data.isAuthenticated && data.user.role === 'admin') {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '✅ ADMIN AUTHENTICATED';
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '❌ NOT AUTHENTICATED AS ADMIN';
                }
                console.log('Auth check complete:', data);
            } catch (error) {
                console.log('Auth check failed:', error);
            }
        }
        
        async function loginAsAdmin() {
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'password123' })
                });
                const data = await response.json();
                console.log('Login response:', data);
                checkAuth();
            } catch (error) {
                console.log('Login failed:', error);
            }
        }
        
        async function testPropertiesAPI() {
            try {
                const response = await fetch('/api/properties');
                const data = await response.json();
                const statusDiv = document.getElementById('api-status');
                
                if (data.success) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = `✅ Properties API Working (${data.data.length} properties)`;
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '❌ Properties API Failed';
                }
                console.log('Properties API test:', data);
            } catch (error) {
                console.log('Properties API test failed:', error);
            }
        }
        
        async function testApplicationsAPI() {
            try {
                const response = await fetch('/api/application');
                const data = await response.json();
                console.log('Applications API test:', data);
            } catch (error) {
                console.log('Applications API test failed:', error);
            }
        }
        
        function testOpenModal() {
            // Create a simple modal for testing
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 20%; left: 30%; width: 40%; 
                background: white; padding: 20px; border: 1px solid #ccc;
                z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            `;
            modal.innerHTML = `
                <h3>Test Modal</h3>
                <p>This modal was opened successfully!</p>
                <button onclick="this.parentElement.remove()">Close</button>
            `;
            document.body.appendChild(modal);
            console.log('✅ Modal opened successfully');
        }
        
        async function testLoadProperties() {
            try {
                const response = await fetch('/api/properties');
                const data = await response.json();
                console.log('✅ Properties loaded:', data.data.length, 'properties');
            } catch (error) {
                console.log('❌ Failed to load properties:', error);
            }
        }
        
        async function testDeleteProperty(id) {
            if (confirm('This will test the delete functionality. Continue?')) {
                try {
                    const response = await fetch(`/api/properties/${id}`, { method: 'DELETE' });
                    const data = await response.json();
                    console.log('Delete test result:', data);
                } catch (error) {
                    console.log('Delete test failed:', error);
                }
            }
        }
        
        // Initialize
        console.log('=== BUTTON TEST PAGE LOADED ===');
        checkAuth();
    </script>
</body>
</html>